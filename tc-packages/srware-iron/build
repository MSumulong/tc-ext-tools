#
# tc-ext-tools build functions: configure, compile, install, rules
#

### Install
build_install() {

  install -m 755 -d "$INSTALL_ROOT/usr/local/iron" || return 1

  cp -a * "$INSTALL_ROOT/usr/local/iron" || return 1
  rm -f "$INSTALL_ROOT/usr/local/iron/README"
  rm -f "$INSTALL_ROOT/usr/local/iron/xdg-settings"
  rm -f "$INSTALL_ROOT/usr/local/iron/chrome-wrapper"
  rm -rf "$INSTALL_ROOT/usr/local/iron/locales"
  rm -f "$INSTALL_ROOT"/usr/local/iron/*.so*

  find "$INSTALL_ROOT/usr/local/iron/" -type f -exec chmod 644 {} +
  find "$INSTALL_ROOT/usr/local/iron/" -type d -exec chmod 755 {} +
  chmod a+x "$INSTALL_ROOT/usr/local/iron/iron"
  chmod a+x "$INSTALL_ROOT/usr/local/iron/libffmpegsumo.so"

  install -m 755 -d "$INSTALL_ROOT/usr/local/share/pixmaps" || return 1
  mv "$INSTALL_ROOT/usr/local/iron/product_logo_48.png" "$INSTALL_ROOT/usr/local/share/pixmaps/iron.png" 

  install -m 644 -D ${PACKAGE_SRC}/iron.desktop ${INSTALL_ROOT}/usr/local/share/applications/iron.desktop || return 1
  install -m 755 -D ${PACKAGE_SRC}/iron.sh ${INSTALL_ROOT}/usr/local/bin/iron || return 1

  install -m 755 -d ${INSTALL_ROOT}/usr/local/iron-addons || return 1
  cp -a locales ${INSTALL_ROOT}/usr/local/iron-addons || return 1
  ln -s /usr/local/iron-addons/plugins ${INSTALL_ROOT}/usr/local/iron/plugins || return 1
  ln -s /usr/local/iron-addons/locales ${INSTALL_ROOT}/usr/local/iron/locales || return 1

}
##

### Rules
build_rules() {

  buildit load || exit 1
  buildit download || exit 1
  buildit convert || exit 1
  buildit unpack || exit 1
  buildit install || exit 1
  buildit split || exit 1
  buildit strip || exit 1
  buildit create || exit 1
  buildit generate || exit 1
  buildit check || exit 1
  buildit package || exit 1

}
##
