#
# tc-ext-tools build functions: configure, compile, install, rules
#

build_configure() {

   mkdir build
   cd build
   cmake -DCMAKE_INSTALL_PREFIX=/usr/local -DCMAKE_BUILD_TYPE=Release -DCMAKE_SKIP_RPATH=ON -DWITH_Xine=OFF -DWITH_PulseAudio=ON .. || return 1

}

build_compile() {

   cd build
   make || return 1

}

build_install() {

   cd build/dragonplayer &&
   make DESTDIR=${PACKAGE_BIN}/${PACKAGE}-dragonplayer install || return 1
   cd ../doc/dragonplayer &&
   make DESTDIR=${PACKAGE_BIN}/${PACKAGE}-dragonplayer install || return 1
   cd ..

   cd ../juk &&
   make DESTDIR=${PACKAGE_BIN}/${PACKAGE}-juk install || return 1
   cd ../doc/juk &&
   make DESTDIR=${PACKAGE_BIN}/${PACKAGE}-juk install || return 1
   cd ..

   for i in kioslave libkcddb libkcompactdisc doc/kioslave
   do
       cd ../${i} &&
       make DESTDIR=${PACKAGE_BIN}/${PACKAGE}-kioslave install || return 1
   done
   cd ..

   for i in kmix doc/kmix
   do
       cd ../${i} &&
       make DESTDIR=${PACKAGE_BIN}/${PACKAGE}-kmix install || return 1
   done
   cd ..

   cd ../kscd &&
   make DESTDIR=${PACKAGE_BIN}/${PACKAGE}-kscd install || return 1
  
   cd ../mplayerthumbs &&
   make DESTDIR=${PACKAGE_BIN}/${PACKAGE}-mplayerthumbs install || return 1

   cd ../ffmpegthumbs &&
   make DESTDIR=${PACKAGE_BIN}/${PACKAGE}-ffmpegthumbs install || return 1

   install -m 755 -d ${PACKAGE_BIN}/${PACKAGE}/usr/local/share/doc/${PACKAGE}
cat > ${PACKAGE_BIN}/${PACKAGE}/usr/local/share/doc/${PACKAGE}/README << EOF
This is a meta extension that loads

	dragonplayer
	juk
	kioslave
	kmix
	kscd
	mplayerthumbs
	ffmpegthumbs

from ${PACKAGE}-${VERSION}

Sercan Arslan <arslanserc@gmail.com>

EOF

   install -m 755 -d ${PACKAGE_BIN}/${PACKAGE}-mplayerthumbs/usr/local/share/config/mplayerthumbs
cat > ${PACKAGE_BIN}/${PACKAGE}-mplayerthumbs/usr/local/share/config/mplayerthumbs/mplayerthumbs.config << EOF
[MPlayerThumbsCfg]
backend=0
EOF

   ln -s kde4/dragonplayer.desktop ${PACKAGE_BIN}/${PACKAGE}-dragonplayer/usr/local/share/applications/${PACKAGE}-dragonplayer.desktop
   ln -s kde4/juk.desktop ${PACKAGE_BIN}/${PACKAGE}-juk/usr/local/share/applications/${PACKAGE}-juk.desktop

}

build_rules() {

  buildit load || exit 1
  buildit download || exit 1
  buildit convert || exit 1
  buildit unpack || exit 1
  buildit patch || exit 1
  buildit configure || exit 1
  buildit compile || exit 1
  buildit install || exit 1
  buildit strip || exit 1
  buildit create || exit 1
  buildit generate || exit 1
  buildit check || exit 1
  buildit package || exit 1

}
