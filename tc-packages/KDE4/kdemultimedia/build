#
# tc-ext-tools build functions: configure, compile, install, rules
#

build_configure() {

   ## pulseaudio support
   #sudo mv /usr/local/include/pulse/version.h /usr/local/include/pulse/version_old.h
   #sed 's/#define pa_get_headers_version() ("UNKNOWN")/#define pa_get_headers_version() ("0.9.22")/g' /usr/local/include/pulse/version_old.h > /tmp/version.h
   #sudo mv /tmp/version.h /usr/local/include/pulse/version.h

   [ -d build ] || mkdir build
   cd build
   cmake -DCMAKE_INSTALL_PREFIX=/usr/local -DCMAKE_BUILD_TYPE=Release -DCMAKE_SKIP_RPATH=ON -DWITH_Xine=OFF -DWITH_PulseAudio=OFF .. || return 1

}

build_compile() {

   cd build
   make || return 1

}

build_install() {

   cd build/dragonplayer &&
   make DESTDIR=${TCEXTTOOLS_BIN}/${PACKAGE}-dragonplayer install || return 1
   cd ../doc/dragonplayer &&
   make DESTDIR=${TCEXTTOOLS_BIN}/${PACKAGE}-dragonplayer install || return 1
   cd ..

   cd ../juk &&
   make DESTDIR=${TCEXTTOOLS_BIN}/${PACKAGE}-juk install || return 1
   cd ../doc/juk &&
   make DESTDIR=${TCEXTTOOLS_BIN}/${PACKAGE}-juk install || return 1
   cd ..

   for i in kioslave libkcddb libkcompactdisc doc/kioslave
   do
       cd ../${i} &&
       make DESTDIR=${TCEXTTOOLS_BIN}/${PACKAGE}-kioslave install || return 1
   done
   cd ..

   for i in kmix doc/kmix
   do
       cd ../${i} &&
       make DESTDIR=${TCEXTTOOLS_BIN}/${PACKAGE}-kmix install || return 1
   done
   cd ..

   cd ../kscd &&
   make DESTDIR=${TCEXTTOOLS_BIN}/${PACKAGE}-kscd install || return 1
  
   cd ../mplayerthumbs &&
   make DESTDIR=${TCEXTTOOLS_BIN}/${PACKAGE}-mplayerthumbs install || return 1

   install -m 755 -d ${TCEXTTOOLS_BIN}/${PACKAGE}/usr/local/share/doc/${PACKAGE}
cat > ${TCEXTTOOLS_BIN}/${PACKAGE}/usr/local/share/doc/${PACKAGE}/README << EOF
This is a meta package that contains:

	dragonplayer
	juk
	kioslave
	kmix
	kscd
	mplayerthumbs

from ${PACKAGE} source package

Sercan Arslan <arslanserc@gmail.com>

EOF

   install -m 755 -d ${TCEXTTOOLS_BIN}/${PACKAGE}-mplayerthumbs/usr/local/share/config/mplayerthumbs
cat > ${TCEXTTOOLS_BIN}/${PACKAGE}-mplayerthumbs/usr/local/share/config/mplayerthumbs/mplayerthumbs.config << EOF
[MPlayerThumbsCfg]
backend=0
EOF

   echo "X-FullPathIcon=/usr/local/share/icons/hicolor/64x64/apps/dragonplayer.png" >> ${TCEXTTOOLS_BIN}/${PACKAGE}-dragonplayer/usr/local/share/applications/kde4/dragonplayer.desktop
   echo "X-FullPathIcon=/usr/local/share/icons/hicolor/64x64/apps/juk.png" >> ${TCEXTTOOLS_BIN}/${PACKAGE}-juk/usr/local/share/applications/kde4/juk.desktop

   ln -s kde4/dragonplayer.desktop ${TCEXTTOOLS_BIN}/${PACKAGE}-dragonplayer/usr/local/share/applications/${PACKAGE}-dragonplayer.desktop
   ln -s kde4/juk.desktop ${TCEXTTOOLS_BIN}/${PACKAGE}-dragonplayer/usr/local/share/applications/${PACKAGE}-juk.desktop

}

build_rules() {

  buildit load || exit 1
  buildit download || exit 1
  buildit convert || exit 1
  buildit unpack || exit 1
  buildit patch || exit 1
  buildit configure || exit 1
  buildit compile || exit 1
  buildit install || exit 1
  stripit "$TCEXTTOOLS_BIN" || exit 1
  buildit create || exit 1
  buildit generate || exit 1
  buildit check || exit 1
  buildit package || exit 1
  buildit compress || exit 1
  buildit encrypt || exit 1

}