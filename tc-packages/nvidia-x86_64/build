#
# tc-ext-tools build functions: configure, compile, install, rules
#

build_convert() {

   sh $PACKAGE_SOURCE --extract-only || return 1

   tar -cJvf $CONVERTED_SOURCE $TOP_SRC || return 1

   busybox mv -f $CONVERTED_SOURCE $TCEXTTOOLS_SRC || return 1

}

build_unpack() {

   sh $PACKAGE_SOURCE --extract-only || return 1

}

# Configure
build_configure() {

   return 0

}

# Compile
build_compile() {

   unset CFLAGS CXXFLAGS

   cd kernel &&
   make CC=x86_64-unknown-linux-gnu-gcc LD=x86_64-unknown-linux-gnu-ld IGNORE_CC_MISMATCH=1 module || return 1

}

# Install
build_install() {

   cd kernel
   # kernel module
   install -d -m 755 $INSTALL_ROOT/usr/local/lib/modules/$KERNELVER/kernel/drivers/video
   install -m 644 nvidia.ko $INSTALL_ROOT/usr/local/lib/modules/$KERNELVER/kernel/drivers/video/nvidia.ko || return 1

}

# Rules
build_rules() {

   buildit load || exit 1
   buildit download || exit 1
   buildit convert || exit 1
   buildit unpack || exit 1
   buildit compile || exit 1
   buildit install || exit 1
   buildit split || exit 1
   buildit create || exit 1
   buildit generate || exit 1
   buildit check || exit 1
   buildit package || exit 1
   buildit compress || exit 1
   buildit encrypt || exit 1

}
