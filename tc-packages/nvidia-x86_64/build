#
# tc-ext-tools build functions: configure, compile, install, rules
#

build_convert() {

   sh "$PACKAGE_SOURCE" --extract-only || return 1

   tar -cJvf "$PACKAGE_SOURCE_NAME_CONV" "$SOURCE_TOPDIR" || return 1

   busybox mv -f "$PACKAGE_SOURCE_NAME_CONV" "$_P_SRC" || return 1

}

build_unpack() {

   sh "$PACKAGE_SOURCE" --extract-only || return 1

}

# Compile
build_compile() {

   cd kernel &&
   make SYSSRC="$TET_LINUX_BUILD" CROSS_COMPILE="$CROSS_COMPILE" IGNORE_CC_MISMATCH=1 module || return 1

}

# Install
build_install() {

   cd kernel
   # kernel module
   install -d -m 755 "$INSTALL_ROOT/usr/local/lib/modules/$KERNEL/kernel/drivers/video"
   install -m 644 nvidia.ko "$INSTALL_ROOT/usr/local/lib/modules/$KERNEL/kernel/drivers/video/nvidia.ko" || return 1

}

# Rules
build_rules() {

   tet_load
   tet_download
   tet_convert
   tet_unpack
   tet_compile
   tet_install
   tet_split
   tet_create
   tet_generate
   tet_check
   tet_package

}
