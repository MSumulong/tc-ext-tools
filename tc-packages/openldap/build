#
# tc-ext-tools build functions: configure, compile, install, rules
#

export LIBS="-ldb -lgnutls -lgcrypt -lgpg-error"

# Configure
build_configure() {

   ./configure --prefix=/usr/local \
        --localstatedir=/var/lib/openldap \
	--disable-debug \
	--enable-crypt \
	--enable-modules \
	--enable-rlookups \
	--enable-backends=mod \
	--enable-overlays=mod \
	--disable-ndb \
	--enable-slp \
	--enable-bdb \
	--enable-slapd \
	--enable-ldap \
	--enable-rewrite \
	--enable-cleartext --enable-slapi \
	--enable-dyngroup --enable-proxycache \
	--enable-syncprov \
	--enable-syslog --enable-dynamic \
	--enable-local --enable-proctitle \
	--enable-ipv6 \
	--enable-spasswd \
	--enable-wrappers \
	--with-tls=gnutls \
	--with-odbc=iodbc \
	--with-cyrus-sasl || return 1

}

# Compile
build_compile() {

   make depend || return 1

   make || return 1

}

# Install
build_install() {

   make DESTDIR="$INSTALL_ROOT" install || return 1

   for LINK in lber ldap ldap_r
   do
       chmod 755 "$INSTALL_ROOT"/usr/local/lib/$(readlink "$INSTALL_ROOT/usr/local/lib/lib${LINK}.so")
   done

   install -d -m 755 "$INSTALL_ROOT"/usr/local/etc/init.d
   install -d -m 755 "$INSTALL_ROOT"/usr/local/etc/default
   install -m 644 "$PACKAGE_SRC"/openldap-server.conf "$INSTALL_ROOT"/usr/local/etc/default/openldap-server
   install -m 755 "$PACKAGE_SRC"/openldap-server.sh "$INSTALL_ROOT"/usr/local/etc/init.d/openldap-server

}

# Rules
build_rules() {

   tet_load
   tet_download
   tet_convert
   tet_unpack
   tet_patch
   tet_configure
   tet_compile
   tet_install
   tet_split
   tet_strip
   tet_create
   tet_generate
   tet_check
   tet_package

}
