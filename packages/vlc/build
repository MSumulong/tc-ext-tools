#
# tc-ext-tools build functions: configure, compile, install, rules
#

# link against libx11 from libx11-xcb
export LDFLAGS="-Wl,-O1,-rpath,/usr/local/lib"

### Configure
build_configure() {

   sed -e "s|/usr/include/groupsock|/usr/local/include/groupsock|" \
       -e "s|/usr/include/liveMedia|/usr/local/include/liveMedia|" \
       -e "s|/usr/include/BasicUsageEnvironment|/usr/local/include/BasicUsageEnvironment|" \
       -e "s|/usr/include/UsageEnvironment|/usr/local/include/UsageEnvironment|" \
       -i configure || return 1

   ./configure --prefix=/usr/local --disable-rpath --enable-glx \
       --disable-dbus --disable-dbus-control --enable-fribidi --enable-nls --enable-x264 \
       --disable-ncurses --enable-libtar --enable-skins2 --enable-mkv --enable-pulse \
       --enable-xvideo --enable-theora --disable-caca --enable-xcb --enable-alsa \
       --enable-avformat --enable-avcodec --enable-postproc --enable-swscale --enable-oss \
       --enable-a52 --enable-dca --enable-faad --enable-libmpeg2 --enable-live555 \
       --enable-mad --disable-libcddb --disable-vcdx --enable-vcd --enable-zvbi \
       --disable-lua --disable-telx --disable-lirc --disable-pvr --enable-goom --enable-taglib \
       --enable-dvbpsi --enable-libxml2 --enable-ogg --enable-vorbis --disable-speex \
       --enable-dvdread --enable-dvdnav --enable-shout --enable-notify --enable-screen \
       --enable-mpc --disable-gme --enable-twolame --enable-flac --enable-schroedinger \
       --disable-mtp --enable-png --disable-sdl --disable-sdl-image --enable-realrtsp \
       --enable-visual --enable-gnutls --disable-projectm --enable-svg \
       --disable-libva --disable-udev --enable-v4l2 --disable-sse --disable-mmx \
       --enable-libproxy --disable-opencv --disable-dc1394 --disable-dv \
       --disable-smb || return 1

}
##

# remove symlinks to link static
build_static() {

   cd /usr/local/lib
   sudo rm -f liba52.so* liba52.la
   sudo rm -f libdca.so* libdca.la
   sudo rm -f libfaad.so* libfaad.la
   sudo rm -f libmad.so* libmad.la
   sudo rm -f libmpcdec.so* libmpcdec.la
   sudo rm -f libmpeg2*.so* libmpeg2*.la
   sudo rm -f libebml.so* libebmla.la
   sudo rm -f libmatroska.so* libmatroska.la
   sudo rm -f libshout.so* libshout.la
   sudo rm -f libtwolame.so* libtwolame.la

}

### Compile
build_compile() {

   make || return 1

}
##

### Install
build_install() {

   make DESTDIR="$INSTALL_ROOT" install || return 1

   for res in 16 32 48 128; do
     install -D -m644 "share/icons/${res}x${res}/vlc.png" "$INSTALL_ROOT/usr/local/share/icons/hicolor/${res}x${res}/apps/vlc.png" || return 1
   done

}
##

### Rules
build_rules() {

   tet_load
   tet_download
   tet_convert
   tet_unpack
   tet_patch
   tet_configure
   tet_custom static
   tet_compile
   tet_install
   tet_split
   tet_strip
   tet_create
   tet_generate
   tet_check
   tet_test
   tet_package
   tet_encrypt

}
##
