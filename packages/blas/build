
############################################################################
#                                                                          #
#    package build functions: configure, compile, install, rules, etc.     #
#                                                                          #
############################################################################

export FC=gfortran

## configure
build_configure() {

   cp -f "$PACKAGE_SRC/Makefile.blas" BLAS/SRC/Makefile 
   cp -f INSTALL/make.inc.gfortran make.inc

}

## compile
build_compile() {

   [ -L /usr/local/bin/gfortran ] && sudo cp -Lf /usr/local/bin/gfortran /usr/local/bin/

   cd BLAS/SRC
   make clean || return 1
   FFLAGS="${CFLAGS/-O?/-O0}" make dcabs1.o || return 1
   FFLAGS="${CFLAGS} -fPIC" CFLAGS="${CFLAGS} -fPIC" make shared || return 1
   cp libblas.so.${VERSION} "$PACKAGE_SOURCE_TOPDIR"

}

## install
build_install() {

   install -m755 -d "${INSTALL_ROOT}/usr/local/lib"
   install -m755 "libblas.so.${VERSION}" "${INSTALL_ROOT}/usr/local/lib/" || return 1
   ln -sf libblas.so.${VERSION} "${INSTALL_ROOT}/usr/local/lib/libblas.so"
   ln -sf libblas.so.${VERSION} "${INSTALL_ROOT}/usr/local/lib/libblas.so.3"
  
   install -m755 -d "${INSTALL_ROOT}/usr/local/share/licenses/blas"
   install -m644 "${PACKAGE_SRC}/LICENSE.blas" "${INSTALL_ROOT}/usr/local/share/licenses/blas/LICENSE" || return 1

}

## rules
build_rules() {

   tet_load
   tet_download
   tet_convert
   tet_unpack
   tet_patch
   tet_configure
   tet_compile
   tet_install
   tet_split
   tet_strip
   tet_create
   tet_generate
   tet_check
   tet_package

}

