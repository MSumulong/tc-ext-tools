
############################################################################
#                                                                          #
#  tc-ext-tools build functions: configure, compile, install, rules, etc.  #
#                                                                          #
############################################################################

build_unpack() {

   mkdir java-sun
   cd java-sun

   wget --no-check-certificate http://java.net/projects/jdk-distros/sources/svn/content/trunk/utils/construct.sh?raw=true -O construct.sh || return 1
   chmod +x construct.sh

   mkdir unbundle-jdk
   cd unbundle-jdk
   sh "$PACKAGE_SOURCE" --accept-license
   tar xf "$_P_SRC/$JAVA_DEMOS_SOURCE" || return 1
   cd ..
   ./construct.sh unbundle-jdk linux-jdk linux-jre || return 1

}

############################################################################ 
#                              Install                                     #
############################################################################

build_install() {

  # main files for java-sun
  mkdir -p ${INSTALL_ROOT}/usr/local
  cp -R linux-jdk ${INSTALL_ROOT}/usr/local/java-sun

  # profiles
  install -D ${PACKAGE_SRC}/jre.profile ${INSTALL_ROOT}/etc/profile.d/sun-jre.sh

  mkdir -p ${INSTALL_ROOT}/usr/local/lib/mozilla/plugins

  ln -s /usr/local/java-sun/jre/lib/i386/libnpjp2.so ${INSTALL_ROOT}/usr/local/lib/mozilla/plugins

  # licenses
  install -d -m 755 ${INSTALL_ROOT}/usr/local/share/licenses/sun-jre
  install -m644 ${INSTALL_ROOT}/usr/local/java-sun/jre/COPYRIGHT ${INSTALL_ROOT}/usr/local/share/licenses/sun-jre
  install -m644 ${INSTALL_ROOT}/usr/local/java-sun/jre/LICENSE ${INSTALL_ROOT}/usr/local/share/licenses/sun-jre
  install -m644 ${INSTALL_ROOT}/usr/local/java-sun/jre/THIRDPARTYLICENSEREADME.txt ${INSTALL_ROOT}/usr/local/share/licenses/sun-jre

  #copy icon
  install -D -m644 ${PACKAGE_SOURCE_TOPDIR}/linux-jdk/jre/lib/desktop/icons/hicolor/48x48/apps/sun-java.png ${INSTALL_ROOT}/usr/local/share/pixmaps/java.png

  # profiles
  install -D ${PACKAGE_SRC}/jdk.profile ${INSTALL_ROOT}/etc/profile.d/sun-jdk.sh

  # licenses
  install -d -m 755 ${INSTALL_ROOT}/usr/local/share/licenses/sun-jdk
  install -m644 ${INSTALL_ROOT}/usr/local/java-sun/COPYRIGHT ${INSTALL_ROOT}/usr/local/share/licenses/sun-jdk
  install -m644 ${INSTALL_ROOT}/usr/local/java-sun/LICENSE ${INSTALL_ROOT}/usr/local/share/licenses/sun-jdk
  install -m644 ${INSTALL_ROOT}/usr/local/java-sun/THIRDPARTYLICENSEREADME.txt ${INSTALL_ROOT}/usr/local/share/licenses/sun-jdk

  # desktop entries
  install -Dm644 ${PACKAGE_SRC}/java-control-panel.desktop ${INSTALL_ROOT}/usr/local/share/applications/java-control-panel.desktop
  install -Dm644 ${PACKAGE_SRC}/java-monitoring-and-management-console.desktop ${INSTALL_ROOT}/usr/local/share/applications/java-monitoring-and-management-console.desktop
  install -Dm644 ${PACKAGE_SRC}/java-policy-settings.desktop ${INSTALL_ROOT}/usr/local/share/applications/java-policy-settings.desktop
  install -Dm644 ${PACKAGE_SRC}/java-visualvm.desktop ${INSTALL_ROOT}/usr/local/share/applications/java-visualvm.desktop
  install -Dm644 ${PACKAGE_SRC}/java-web-start.desktop ${INSTALL_ROOT}/usr/local/share/applications/java-web-start.desktop

  # javadb (apache derby) daemon files
  install -D ${PACKAGE_SRC}/derby-network-server ${INSTALL_ROOT}/usr/local/etc/init.d/derby-network-server
  install -D -m644 ${PACKAGE_SRC}/derby-network-server.conf ${INSTALL_ROOT}/usr/local/etc/conf.d/derby-network-server

}

############################################################################ 
#                                Rules                                     #
############################################################################

build_rules() {

   tet_load
   tet_download
   tet_unpack
   tet_install
   tet_split
   tet_create
   tet_generate
   tet_check
   tet_test
   tet_package
   tet_encrypt

}

