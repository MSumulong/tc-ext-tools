#
# tc-ext-tools build functions: configure, compile, install, rules
#

build_unpack() {

   sh "$PACKAGE_SOURCE" --extract-only || return 1

}

# Compile
build_compile() {

   unset CFLAGS CXXFLAGS LDFLAGS

   cd kernel
   make SYSSRC=/usr/src/linux CC="${CROSS_COMPILE}gcc" LD="${CROSS_COMPILE}ld" IGNORE_CC_MISMATCH=1 module || return 1

}

# Install
build_install() {

   cd kernel
   # kernel module
   install -d -m 755 "$INSTALL_ROOT/usr/local/lib/modules/$KERNEL/kernel/drivers/video"
   install -m 644 nvidia.ko "$INSTALL_ROOT/usr/local/lib/modules/$KERNEL/kernel/drivers/video/nvidia.ko" || return 1
   gzip "$INSTALL_ROOT/usr/local/lib/modules/$KERNEL/kernel/drivers/video/nvidia.ko"

}

# Rules
build_rules() {

   tet_load
   tet_prepare
   tet_download
   tet_unpack
   tet_compile
   tet_install
   tet_split
   tet_create
   tet_generate
   tet_check
   tet_test
   tet_package
   tet_encrypt

}

