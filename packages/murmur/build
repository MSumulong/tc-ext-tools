
############################################################################################
#                                                                                          #
#    package build functions: configure, compile, install, rules, and custom functions     #
#                                                                                          #
############################################################################################

## configure
build_configure() {

  qmake main.pro CONFIG+="no-client no-ice" || return 1

}

## compile
build_compile() {

  make release || return 1

}

## install
build_install() {

  sed -e "1i# vi:ft=cfg" \
    -e "s|database=|database=/var/lib/murmur/murmur.sqlite|" \
    -e "s|dbus=session|#dbus=system|" \
    -e "s|#logfile=murmur.log|logfile=/var/log/murmur/murmur.log|" \
    -e "s|#pidfile=|pidfile=/var/run/murmur/murmur.pid|" \
    -e "s|#uname=|uname=murmur|" \
    -i scripts/murmur.ini

  install -Dm755 release/murmurd ${I_ROOT}/usr/local/sbin/murmurd
  install -Dm644 scripts/murmur.ini ${I_ROOT}/usr/local/etc/murmur.ini
  install -Dm755 ${P_SRC}/murmur.init.d ${I_ROOT}/usr/local/etc/init.d/murmur
  install -Dm644 ${P_SRC}/murmur.conf.d ${I_ROOT}/usr/local/etc/conf.d/murmur
  install -Dm644 ${P_SRC}/murmur.dbus.conf ${I_ROOT}/usr/local/etc/dbus-1/system.d/murmur.conf
  install -Dm644 README ${I_ROOT}/usr/local/share/doc/murmur/README
  install -Dm644 man/murmurd.1 ${I_ROOT}/usr/local/share/man/man1/murmurd.1

}

## rules
build_rules() {

   tet_load
   tet_download
   tet_convert
   tet_unpack
   tet_patch
   tet_configure
   tet_compile
   tet_install
   tet_split
   tet_strip
   tet_create
   tet_generate
   tet_check
   tet_test
   tet_package
   tet_encrypt

}

