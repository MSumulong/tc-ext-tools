
############################################################################
#                                                                          #
#    package build functions: configure, compile, install, rules, etc.     #
#                                                                          #
############################################################################

export FC=gfortran

## configure
build_configure() {

   cp -f "$PACKAGE_SRC/Makefile.lapack" SRC/Makefile 
   cp -f INSTALL/make.inc.gfortran make.inc

}

## compile
build_compile() {

   [ -L /usr/local/bin/gfortran ] && sudo cp -Lf /usr/local/bin/gfortran /usr/local/bin/

   cd INSTALL
   make clean || return 1
   make NOOPT="${CFLAGS/-O?/-O0} -fPIC" OPTS="${CFLAGS} -fPIC" || return 1

   cd ../SRC
   make clean || return 1
   make FFLAGS="${CFLAGS} -fPIC" CFLAGS="${CFLAGS} -fPIC" shared || return 1
   cp liblapack.so.${VERSION} "$PACKAGE_SOURCE_TOPDIR"

}

## install
build_install() {

   install -m755 -d "${INSTALL_ROOT}/usr/local/lib"
   install -m755 "liblapack.so.${VERSION}" "${INSTALL_ROOT}/usr/local/lib/" || return 1
   ln -sf liblapack.so.${VERSION} "${INSTALL_ROOT}/usr/local/lib/liblapack.so"
   ln -sf liblapack.so.${VERSION} "${INSTALL_ROOT}/usr/local/lib/liblapack.so.3"
  
   install -m755 -d "${INSTALL_ROOT}/usr/local/share/licenses/lapack"
   install -m644 LICENSE "${INSTALL_ROOT}/usr/local/share/licenses/lapack/LICENSE" || return 1

}

## rules
build_rules() {

   tet_load
   tet_download
   tet_convert
   tet_unpack
   tet_patch
   tet_configure
   tet_compile
   tet_install
   tet_split
   tet_strip
   tet_create
   tet_generate
   tet_check
   tet_test
   tet_package
   tet_encrypt

}

