
############################################################################################
#                                                                                          #
#    package build functions: configure, compile, install, rules, and custom functions     #
#                                                                                          #
############################################################################################

## compile
build_compile() {

   make || return 1

}

## install
build_install() {

   install -d -m 775 "$I_ROOT"/usr/sbin
   install -d -m 775 "$I_ROOT"/usr/local/etc
   install -d -m 775 "$I_ROOT"/usr/local/share/ca-certificates
   make CERTSDIR=/usr/local/share/ca-certificates DESTDIR="$I_ROOT" install || return 1

   mv "$I_ROOT"/usr/sbin "$I_ROOT"/usr/local/sbin
   install -D -m644 sbin/update-ca-certificates.8 ${I_ROOT}/usr/local/share/man/man8/update-ca-certificates.8

   sed -i 's|CERTSCONF=.*|CERTSCONF=/usr/local/etc/ca-certificates.conf|' ${I_ROOT}/usr/local/sbin/update-ca-certificates
   sed -i 's|CERTSDIR=.*|CERTSDIR=/usr/local/share/ca-certificates|' ${I_ROOT}/usr/local/sbin/update-ca-certificates
   sed -i 's|ETCCERTSDIR=.*|ETCCERTSDIR=/usr/local/etc/ssl/certs|' ${I_ROOT}/usr/local/sbin/update-ca-certificates
   sed -i 's|HOOKSDIR=.*|HOOKSDIR=/usr/local/etc/ca-certificates/update.d|' ${I_ROOT}/usr/local/sbin/update-ca-certificates

   (
    echo "# Automatically generated by ${PACKAGE}-${VERSION}"
    echo "# see update-ca-certificates man page"
    echo "# "
    cd ${I_ROOT}/usr/local/share/ca-certificates
    find . -name '*.crt' | sort | cut -b3-
   ) > ${I_ROOT}/usr/local/etc/ca-certificates.conf

}

## rules
build_rules() {

   tet_load
   tet_download
   tet_convert
   tet_unpack
   tet_patch
   tet_compile
   tet_install
   tet_split
   tet_strip
   tet_create
   tet_generate
   tet_check
   tet_test
   tet_package
   tet_encrypt

}

